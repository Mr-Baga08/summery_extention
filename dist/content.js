if(void 0===window.contentScriptInjected){window.contentScriptInjected=!0;class t{constructor(){this.currentUrl=window.location.href,this.isYouTube=this.detectYouTube()}detectYouTube(){return this.currentUrl.includes("youtube.com/watch")||this.currentUrl.includes("youtu.be/")}async extractYouTubeTranscript(){try{const t=document.querySelectorAll("script");for(const e of t)if(e.textContent.includes("ytInitialPlayerResponse")){const t=/ytInitialPlayerResponse\s*=\s*({.+?});/s,n=e.textContent.match(t);if(n){const t=JSON.parse(n[1]),e=t?.captions?.playerCaptionsTracklistRenderer?.captionTracks;if(e&&e.length>0){const t=e[0].baseUrl+"&fmt=json3",n=await fetch(t),r=await n.json();return this.formatYouTubeTranscript(r)}}}return await this.getYouTubeFallbackContent()}catch(t){return console.error("YouTube extraction error:",t),await this.getYouTubeFallbackContent()}}formatYouTubeTranscript(t){if(!t?.events)return"";let e="";return t.events.forEach(t=>{if(t.segs){const n=t.segs.map(t=>t.utf8).join(""),r=t.tStartMs||0,o=Math.floor(r/1e3),c=Math.floor(o/60);e+=`[${c}:${(o%60).toString().padStart(2,"0")}] ${n}\n`}}),e}async getYouTubeFallbackContent(){const t=["#description-inline-expander","#description","ytd-video-secondary-info-renderer #description"];let e="";for(const n of t){const t=document.querySelector(n);if(t){e=t.innerText;break}}let n="";const r=document.querySelectorAll("ytd-comment-thread-renderer"),o=Math.min(5,r.length);for(let t=0;t<o;t++){const e=r[t]?.querySelector("#content-text")?.innerText||"";e.trim()&&(n+=`Comment ${t+1}: ${e.substring(0,150)}...\n`)}return`VIDEO DESCRIPTION:\n${e}\n\nTOP COMMENTS:\n${n}`}extractWebPageText(){const t=document.body.cloneNode(!0);["nav","footer","header","aside","script","style","iframe",".ad",".advertisement",".navbar",".menu",".sidebar",".social-share",".comments",".related-posts",".newsletter"].forEach(e=>{t.querySelectorAll(e).forEach(t=>t.remove())});let e=t.innerText||t.textContent;return e=e.replace(/\s+/g," ").trim(),e.split(" ").slice(0,2e4).join(" ")}async extractContent(){if(this.isYouTube){const t=await this.extractYouTubeTranscript();return{type:"youtube",content:t,url:this.currentUrl,title:document.title.replace(" - YouTube",""),hasTranscript:!t.includes("VIDEO DESCRIPTION:")}}return{type:"webpage",content:this.extractWebPageText(),url:this.currentUrl,title:document.title}}}chrome.runtime.onMessage.addListener((e,n,r)=>{const o=new t;if("extractContent"===e.action)return o.extractContent().then(t=>{r({success:!0,content:t})}).catch(t=>{r({success:!1,error:t.message})}),!0;if("seekToTime"===e.action&&o.isYouTube){const t=document.querySelector("video");t&&(t.currentTime=e.time,t.play())}})}